{
  "$schema": "https://raw.githubusercontent.com/ScoopInstaller/Scoop/master/schema.json",
  "version": "3.39.1.427",
  "description": "An efficient and reliable video conferencing service powered by Tencent that is built for collaboration.",
  "homepage": "https://meeting.tencent.com/",
  "license": {
    "identifier": "Proprietary",
    "url": "https://meeting.tencent.com/declare.html"
  },

  "architecture": {
    "64bit": {
      // 1) 去掉 #/dl.7z，保持一个“干净”的 URI
      "url": "https://updatecdn.meeting.qq.com/cos/9a27d0a6b9faf68786d997cea293a201/TencentMeeting_0300000000_3.39.1.427_x86_64.publish.exe",
      "hash": "05b8c52eacc6109ebfec5cc7931028596478dfc400dc385d76aea879f07cc859"
    },
    "32bit": {
      "url": "https://updatecdn.meeting.qq.com/cos/9a053777fea7e142b49f2cd85df9e62d/TencentMeeting_0300000000_3.39.1.427.publish.exe",
      "hash": "564767bf8378b1654b7aacb0ba5fb999b62373ba1caa988bf1d4f61fe84ac63e"
    }
  },

  // 2) 在 pre_install 主动解包，而不是依赖 #/dl.7z
  "pre_install": [
    "Expand-7zipArchive -Path \"$dir\\$fname\" -DestinationPath \"$dir\" -Removal"
  ],

  "post_install": [
    // 3) 你的重命名/删除逻辑可保留（注意这行里用了反引号逃逸 $，确保不是误用 $_）
    "Rename-Item \"$dir\\`$_*_\" \"$dir\\$version\"",
    "Remove-Item \"$dir\\$*\" -Recurse -Force -ErrorAction SilentlyContinue",
    "Remove-Item \"$dir\\WeMeetApp_new.exe\", \"$dir\\$version\\WeMeetUninstall.exe\" -Force -ErrorAction SilentlyContinue"
  ],

  "shortcuts": [
    ["WeMeetApp.exe", "WeMeet"]
  ],

  "checkver": {
    "script": [
      "$uri = 'https://api.github.com/repos/microsoft/winget-pkgs/contents/manifests/t/Tencent/TencentMeeting'",
      "$prevProgressPreference = $global:ProgressPreference",
      "$global:ProgressPreference = 'SilentlyContinue'",
      "$latestVersion = ((Invoke-WebRequest -Uri $uri).Content |",
      "  ConvertFrom-Json |",
      "  ForEach-Object { $_.name } |",
      "  Where-Object { $_ -notmatch '^\\.' } |",
      "  Sort-Object -Descending { try { [version]$_ } catch {} })[0]",
      "\"version:$latestVersion\"",
      "$uri = \"https://raw.githubusercontent.com/microsoft/winget-pkgs/master/manifests/t/Tencent/TencentMeeting/$latestVersion/Tencent.TencentMeeting.installer.yaml\"",
      "$installerInfo = (Invoke-WebRequest -Uri $uri).Content",
      "$global:ProgressPreference = $prevProgressPreference",
      "$installerInfo -split '[\\r\\n]+' | ForEach-Object {",
      "  if ($_ -cmatch '^\\s+InstallerUrl:\\s*https://(.+_x86_64.+)$') {",
      "    \"url_x64:$($Matches[1])\"",
      "  } elseif ($_ -cmatch '^\\s+InstallerUrl:\\s*https://(.+)$') {",
      "    \"url_x86:$($Matches[1])\"",
      "  }",
      "}"
    ],
    "regex": "^version:(?<version>\\S+)\\s+url_x86:(?<URLX86>\\S+)\\s+url_x64:(?<URLX64>\\S+)$"
  },

    "autoupdate": {
      "architecture": {
        "64bit": {
          "url": {
            "find": ".*",
            "replace": "https://$matchURLX64"
          },
          "hash": {
            "url": "https://raw.githubusercontent.com/microsoft/winget-pkgs/master/manifests/t/Tencent/TencentMeeting/$version/Tencent.TencentMeeting.installer.yaml",
            "regex": "- Architecture:\\s*x64[\\s\\S]+?InstallerSha256:\\s*$sha256"
          }
        },
        "32bit": {
          "url": {
            "find": ".*",
            "replace": "https://$matchURLX86"
          },
          "hash": {
            "url": "https://raw.githubusercontent.com/microsoft/winget-pkgs/master/manifests/t/Tencent/TencentMeeting/$version/Tencent.TencentMeeting.installer.yaml",
            "regex": "- Architecture:\\s*x86[\\s\\S]+?InstallerSha256:\\s*$sha256"
          }
        }
      }
    }
}

